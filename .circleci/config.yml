version: 2
jobs:
  build:
    docker:
      - image: circleci/ruby:2.3-node
    macos:
      xcode: "9.0"
    environment:
      GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx1024m -XX:+HeapDumpOnOutOfMemoryError"'
      XCODE_SCHEME: browse.goodcity
      XCODE_WORKSPACE: browse.goodcity
      GYM_CODE_SIGNING_IDENTITY: "iPhone Distribution: Crossroads Foundation Limited"
      FL_TESTFAIRY_AUTO_UPDATE: "on"
      PILOT_SKIP_SUBMISSION: true
      PILOT_WAIT_PROCESSING_INTERVAL: 60
    steps:
      - run:
          name: Installations
          command: |
            echo '${HOME}/android-sdk'
            echo '${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin:$HOME/.yarn/bin:$ANDROID_HOME/tools'
          command: brew update
          command: brew install homebrew/core/node6-lts
          command: brew upgrade yarn
          command: brew upgrade bower
          command: yarn install
          command: yarn add --force node-sass
          command: yarn add bower
          command: yarn add ember-cli phantomjs-prebuilt cordova
          command: yarn add codeclimate-test-reporter
          command: bower install
          command: ember server
          command: sleep 5
          command: COVERAGE=true ember test
